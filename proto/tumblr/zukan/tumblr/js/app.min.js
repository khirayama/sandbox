var zukan=zukan||{};(function(){"use strict";zukan.Article=Backbone.Model.extend({defaults:{title:"",body:"",link:"",pubDate:"",tags:[],schedule:"",done:""}});zukan.Articles=Backbone.Collection.extend({model:zukan.Article,comparator:function(e){return e.get("schedule")?e.get("schedule"):-e.get("pubDate")}});zukan.TopView=Backbone.View.extend({el:".main",initialize:function(){this.createArticle();this.listenTo(zukan.topics,"add",this.addOne);this.listenTo(zukan.topics,"sort",this.addAll);this.listenTo(zukan.schedule,"add",this.addOne);this.listenTo(zukan.schedule,"sort",this.addAll);this.listenTo(zukan.discography,"add",this.addOne);this.listenTo(zukan.discography,"sort",this.addAll);zukan.topics.sort();zukan.schedule.sort();zukan.discography.sort()},addOne:function(e){zukan.TopLi=new zukan.TopLiView({model:e});zukan.ShortLi=new zukan.ShortLiView({model:e});e.get("tags").indexOf("topics")!=-1&&$(".topics-list").append(zukan.TopLi.render().el);e.get("tags").indexOf("schedule")!=-1&&$(".schedule-list").append(zukan.ShortLi.render().el);e.get("tags").indexOf("discography")!=-1&&$(".discography-list").append(zukan.TopLi.render().el);e.get("tags").indexOf("live")!=-1&&$(".live-list").append(zukan.TopLi.render().el);e.get("tags").indexOf("media")!=-1&&$(".media-list").append(zukan.TopLi.render().el)},addAll:function(){this.$(".topics-list").html("");this.$(".schedule-list").html("");this.$(".discography-list").html("");this.$(".live-list").html("");this.$(".media-list").html("");zukan.topics.each(this.addOne,this);zukan.schedule.each(this.addOne,this);zukan.discography.each(this.addOne,this)},newAttributes:function(e){return{title:e.title,body:e.body,link:e.link,pubDate:e.pubDate,tags:e.tags,schedule:e.schedule,done:e.done}},createArticle:function(){for(var e=0;e<topics.length;e++)zukan.topics.add(this.newAttributes(topics[e]));for(var e=0;e<discography.length;e++)zukan.discography.add(this.newAttributes(discography[e]));for(var e=0;e<schedule.length;e++)zukan.schedule.add(this.newAttributes(schedule[e]))}});zukan.TopLiView=Backbone.View.extend({tagName:"li",template:_.template($("#top-template").html()),render:function(){this.$el.html(this.template(this.model.toJSON()));this.model.get("done")&&this.$el.addClass("done");return this}});zukan.ShortLiView=Backbone.View.extend({tagName:"li",template:_.template($("#short-template").html()),render:function(){this.$el.html(this.template(this.model.toJSON()));this.model.get("done")&&this.$el.addClass("done");return this}});zukan.ZukanView=Backbone.View.extend({el:"#zukan",initialize:function(){zukan.Top=new zukan.TopView}})})($);$(function(){"use strict";for(var e=0;e<articles.length;e++){articles[e].tags.indexOf("topics")!=-1&&(topics[topics.length]=articles[e]);articles[e].tags.indexOf("schedule")!=-1&&(schedule[schedule.length]=articles[e]);articles[e].tags.indexOf("discography")!=-1&&(discography[discography.length]=articles[e])}for(var e=0;e<schedule.length;e++)for(var t=0;t<schedule[e].tags.length;t++)if(schedule[e].tags[t].indexOf("/")!=-1){var n=new Date(schedule[e].tags[t]),r=new Date;r.setDate(r.getDate()-1);schedule[e].schedule=n;schedule[e].done=r>n?!0:!1}zukan.topics=new zukan.Articles;zukan.discography=new zukan.Articles;zukan.schedule=new zukan.Articles;zukan.App=new zukan.ZukanView;$(".done").remove();$(".topics-list>li").length||$(".main .topics").remove();$(".schedule-list>li").length||$(".main .schedule").remove();$(".live-list>li").length||$(".main .live").remove();$(".media-list>li").length||$(".main .media").remove();$(".hot>a").length||$(".main .hot").remove()});